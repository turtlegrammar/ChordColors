(function(t){function e(e){for(var o,a,c=e[0],s=e[1],u=e[2],h=0,f=[];h<c.length;h++)a=c[h],Object.prototype.hasOwnProperty.call(i,a)&&i[a]&&f.push(i[a][0]),i[a]=0;for(o in s)Object.prototype.hasOwnProperty.call(s,o)&&(t[o]=s[o]);l&&l(e);while(f.length)f.shift()();return r.push.apply(r,u||[]),n()}function n(){for(var t,e=0;e<r.length;e++){for(var n=r[e],o=!0,c=1;c<n.length;c++){var s=n[c];0!==i[s]&&(o=!1)}o&&(r.splice(e--,1),t=a(a.s=n[0]))}return t}var o={},i={app:0},r=[];function a(e){if(o[e])return o[e].exports;var n=o[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=t,a.c=o,a.d=function(t,e,n){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)a.d(n,o,function(e){return t[e]}.bind(null,o));return n},a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],s=c.push.bind(c);c.push=e,c=c.slice();for(var u=0;u<c.length;u++)e(c[u]);var l=s;r.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("cd49")},"5c0b":function(t,e,n){"use strict";n("9c0c")},"9c0c":function(t,e,n){},cd49:function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var o=n("2b0e"),i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-app",{staticClass:"ma-0 pa-0",attrs:{width:t.options.canvas.width,height:t.options.canvas.height}},[n("v-main",[n("v-container",[n("v-row",[n("v-col",{staticClass:"lg-6"},[n("options-editor",{model:{value:t.options,callback:function(e){t.options=e},expression:"options"}})],1)],1)],1)],1),n("canvas",{attrs:{id:"canvas",width:t.options.canvas.width,height:t.options.canvas.height}})],1)},r=[],a=(n("cb29"),n("4160"),n("d81d"),n("b0c0"),n("d3b7"),n("8a59"),n("9a8c"),n("a975"),n("735e"),n("c1ac"),n("d139"),n("3a7b"),n("d5d6"),n("82f8"),n("e91f"),n("60bd"),n("5f96"),n("3280"),n("3fcc"),n("ca91"),n("25a1"),n("cd26"),n("3c5d"),n("2954"),n("649e"),n("219c"),n("170b"),n("b39a"),n("72f7"),n("159b"),n("2909")),c=n("d4ec"),s=n("bee2"),u=n("262e"),l=n("2caf"),h=n("9ab4"),f=n("1b40"),d=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("vue-json-editor",{attrs:{expandedOnStart:!0},on:{"json-change":t.onJsonChange},model:{value:t.options,callback:function(e){t.options=e},expression:"options"}})],1)},v=[],p=n("5530"),g=n("a523"),m=n("0fd9"),b=n("62ad"),w=n("b974"),y=n("ac7c"),M=n("8654"),O=n("8336"),x={display:{waitBeforeClearMilliseconds:100,tickMilliseconds:5},circle:{tonic:"C",degreeOffset:60,saturationFloor:100},viewMode:{single:!1,overtoneGrid:!1,wheel:!0,randomPixelation:!1,concentricPixelation:!0},wheelViewModeConfig:{showOvertones:!1,showEmergence:!1,showEmergentOnly:!1,lineWidth:3,spotlightScaleFactor:.05},canvas:{width:1800,height:1190},mix:{rootBias:1.5,melodyBias:1.5,considerVelocity:!0},render:{rootBias:1,middleBias:1,melodyBias:1,emergentBias:1,emergentBiasFloor:.2},decay:{decayPerSecond:0},overtone:{numberOvertones:7,backoffCoefficient:1.5}},C=n("45a3"),k=function(t){Object(u["a"])(n,t);var e=Object(l["a"])(n);function n(){var t;return Object(c["a"])(this,n),t=e.apply(this,arguments),t.options=Object(p["a"])({},x),t}return Object(s["a"])(n,[{key:"onJsonChange",value:function(t){this.options=t,this.emit()}},{key:"emit",value:function(){return this.options}}]),n}(f["c"]);Object(h["a"])([Object(f["b"])("input")],k.prototype,"emit",null),k=Object(h["a"])([Object(f["a"])({components:{VContainer:g["a"],VRow:m["a"],VCol:b["a"],VSelect:w["a"],VCheckbox:y["a"],VTextField:M["a"],VBtn:O["a"],vueJsonEditor:C["a"]}})],k);var B=k,j=B,E=n("2877"),P=Object(E["a"])(j,d,v,!1,null,null,null),S=P.exports,_=n("7496"),V=n("f6c4"),D=n("fe57"),F=n("71a3"),I=n("c671"),A=(n("a630"),n("4ec9"),n("3ca3"),n("ddb0"),n("25f0"),n("5e54"));n("6062");function z(t,e){var n=[];return t.forEach((function(t){e(t).forEach((function(t){return n.push(t)}))})),n}function N(t,e){return t.map((function(t){return t.map(e)}))}function T(t,e){for(var n=[],o=function(o){n.push(e(t.map((function(t){return t[o]}))))},i=0;i<t[0].length;i++)o(i);return n}function W(t,e){var n=t%12==9?"A":t%12==10?"Bb":t%12==11?"B":t%12==0?"C":t%12==1?"Db":t%12==2?"D":t%12==3?"Eb":t%12==4?"E":t%12==5?"F":t%12==6?"F#":t%12==7?"G":"Ab";return{kind:"scientific",class:n,octave:e}}var G=["A","Bb","B","C","Db","D","Eb","E","F","F#","G","Ab"];z([1,2,3,4,5,6,7,8],(function(t){return G.map((function(e){return e+t.toString()}))}));function J(t){return"midi"==t.kind?t.midi:"scientific"==t.kind?Object(A["a"])(t.class+t.octave.toString()).toMidi():L(t.solfege.solfege)+12*t.solfege.octaveOffset+J(t.tonic)}function L(t){return"do"==t?0:"ra"==t?1:"re"==t?2:"ri"==t||"me"==t?3:"mi"==t?4:"fa"==t?5:"fi"==t||"se"==t?6:"so"==t?7:"si"==t||"le"==t?8:"la"==t?9:"li"==t||"te"==t?10:"ti"==t?11:-1}var R=function(){function t(){Object(c["a"])(this,t),this._notes=new Map,this._sustainOn=!1}return Object(s["a"])(t,[{key:"endSustain",value:function(){this._sustainOn=!1;var t=new Map;this._notes.forEach((function(e,n){e.sustained||t.set(n,e)})),this._notes=t}},{key:"beginSustain",value:function(){this._sustainOn=!0}},{key:"handleNoteOn",value:function(t,e,n){this._notes.set(t,{velocity:n,note:W(t,e),midiNote:t,sustained:!1,timeFirstPresseddMilliseconds:performance.now(),ageMilliseconds:0})}},{key:"handleNoteOff",value:function(t){if(this._sustainOn){var e=this._notes.get(t);void 0!=e&&(e.sustained=!0)}else this._notes.delete(t)}},{key:"getNotes",value:function(){var t=Array.from(this._notes.values());return t.sort((function(t,e){return J(t.note)-J(e.note)})),t}},{key:"tick",value:function(){var t=performance.now();this._notes.forEach((function(e){return e.ageMilliseconds=t-e.timeFirstPresseddMilliseconds}))}}]),t}();n("99af"),n("13d5"),n("4d90");function U(t){var e,n,o,i=t.hue/360,r=t.light/100,a=t.saturation/100;if(0==a)e=n=o=r;else{var c=function(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+(e-t)*(2/3-n)*6:t},s=r<.5?r*(1+a):r+a-r*a,u=2*r-s;e=c(u,s,i+1/3),n=c(u,s,i),o=c(u,s,i-1/3)}return{red:Math.round(255*e),green:Math.round(255*n),blue:Math.round(255*o)}}function $(t){var e=t.hue,n=t.light/100,o=t.saturation,i=o*Math.min(n,1-n)/100,r=function(t){var o=(t+e/30)%12,r=n-i*Math.max(Math.min(o-3,9-o,1),-1);return Math.round(255*r).toString(16).padStart(2,"0")};return"#".concat(r(0)).concat(r(8)).concat(r(4))}var q=new Map([["C",0],["G",30],["D",60],["A",90],["E",120],["B",150],["F#",180],["Db",210],["Ab",240],["Eb",270],["Bb",300],["F",330]]);function H(t,e){return e.map((function(e){return{hue:Math.abs(360-q.get(e.note.class)+t.degreeOffset+q.get(t.tonic))%360,saturation:t.saturationFloor+(100-t.saturationFloor)*e.velocity,light:(J(e.note)-21)*(100/88)}}))}function K(t){return{x:Math.cos(t.hue/180*Math.PI)*t.saturation,y:Math.sin(t.hue/180*Math.PI)*t.saturation,z:t.light}}function Q(t){var e=180*Math.atan2(t.y,t.x)/Math.PI;return{hue:e<0?360+e:e,saturation:Math.sqrt(t.x*t.x+t.y*t.y),light:t.z}}function X(t,e,n){if(1==e.length)return e[0];e.length;for(var o=0,i={x:0,y:0,z:0},r=0;r<e.length;r++){var a=0==r?t.rootBias:r==e.length-1?t.melodyBias:1;a*=t.considerVelocity?n[r]:1,o+=a;var c=K(e[r]);i.x+=c.x*a,i.y+=c.y*a,i.z+=c.z*a}return i.x/=o,i.y/=o,i.z/=o,Q(i)}function Y(t,e){var n=function(e,n){return{hue:e,light:n,saturation:t.saturation}},o=function(e){return Math.min(100,100/88*e+t.light)},i=1,r=[{color:t,weight:1}],a=function(t){i++;var n=1/(e.backoffCoefficient*i);r.push({color:t,weight:n})};return e.numberOvertones>=1&&a(n(t.hue,o(12))),e.numberOvertones>=2&&a(n(t.hue-31,o(19))),e.numberOvertones>=3&&a(n(t.hue,o(24))),e.numberOvertones>=4&&a(n((t.hue-120+4.2)%360,o(28))),e.numberOvertones>=5&&a(n(t.hue-31,o(31))),e.numberOvertones>=6&&a(n((t.hue+60+9.3)%360,o(34))),Z(r),r}function Z(t){var e=t.map((function(t){return t.weight})).reduce((function(t,e){return t+e}),0);t.forEach((function(t){return t.weight/=e}))}var tt=n("c62b"),et=n.n(tt),nt=(n("0481"),n("4069"),function(t,e,n){});function ot(t){return{circleConfig:t.circle,mixConfig:t.mix,renderConfig:t.render,overtoneConfig:t.overtone,decayConfig:t.decay}}function it(t,e){var n=e.width,o=e.height,i=new Uint8ClampedArray(n*o*4),r=new ImageData(i,n);return function(e,n,o){var a=rt(e,n);if(0==a.length)o();else{for(var c=0;c<i.length;c+=4){var s=a[Math.floor(Math.random()*a.length)];i[c]=s.red,i[c+1]=s.green,i[c+2]=s.blue,i[c+3]=s.alpha}t.putImageData(r,0,0)}}}function rt(t,e){var n=t.getNotes(),o=n.map((function(t){return t.velocity})),i=H(e.circleConfig,n);if(0==i.length)return[];var r=Object(a["a"])(i);r.length>1&&r.push(X(e.mixConfig,r,o));for(var c=r.map((function(t){return Y(t,e.overtoneConfig)})),s=0;s<c.length;s++)0==s?c[s].forEach((function(t){return t.weight*=e.renderConfig.rootBias})):s==c.length-1?c[s].forEach((function(t){return t.weight*=e.renderConfig.emergentBias})):s==c.length-2?c[s].forEach((function(t){return t.weight*=e.renderConfig.melodyBias})):c[s].forEach((function(t){return t.weight*=e.renderConfig.middleBias}));var u=c.flat();Z(u);var l=[];return u.forEach((function(t){for(var e=Object(p["a"])(Object(p["a"])({},U(t.color)),{},{alpha:255}),n=0;n<Math.floor(1e4*t.weight);n++)l.push(e)})),l}var at=function(t){Object(u["a"])(n,t);var e=Object(l["a"])(n);function n(){var t;return Object(c["a"])(this,n),t=e.apply(this,arguments),t.options=x,t.midiBatcher=new R,t.ctx=void 0,t.randomPixelator=nt,t.concentricPixelator=function(t,e,n,o,i){},t.wheelDrawer=function(t,e){},t}return Object(s["a"])(n,[{key:"resize",value:function(){this.options.canvas.width=window.innerWidth,this.options.canvas.height=window.innerHeight,this.randomPixelator=it(this.ctx,this.options.canvas),this.concentricPixelator=this.makeConcentricPixelator(this.ctx,this.options.canvas),this.wheelDrawer=this.makeColorWheelDrawer(this.ctx,this.options.canvas)}},{key:"created",value:function(){window.addEventListener("resize",this.resize)}},{key:"destroyed",value:function(){window.removeEventListener("resize",this.resize)}},{key:"drawAll",value:function(t,e,n){for(var o=n.height,i=n.width,r=e.length,a=o/r,c=0;c<r;c++)for(var s=e[c],u=s.length,l=i/u,h=0;h<u;h++){var f=s[h];t.beginPath(),t.fillStyle=f,t.rect(h*l,c*a,l,a),t.fill()}}},{key:"makeColorWheelDrawer",value:function(t,e){var n=e.width,o=e.height,i=new Uint8ClampedArray(n*o*4),r=new ImageData(i,n),a=!1;return function(e,c,s){var u=Math.min(n,o)/2,l=n/2,h=o/2;if(!a){for(var f=n*o,d=0;d<f;d+=1){var v=Math.floor(d/n),p=Math.floor(d-v*n),g=Math.sqrt((p-l)*(p-l)+(v-h)*(v-h));if(g<u){var m=(Math.atan2(v-h,p-l)*(180/Math.PI)+360+90)%360,b={hue:(360-m+s)%360,saturation:100,light:100*g/u},w=U(b);i[4*d]=w.red,i[4*d+1]=w.green,i[4*d+2]=w.blue,i[4*d+3]=255}}a=!0}t.putImageData(r,0,0);for(var y=0;y<e.length;y++)if((!c.showEmergentOnly||y==e.length-1)&&(c.showEmergence||y!=e.length-1))for(var M=e[y],O=0;O<M.length;O++)if(c.showOvertones||!(O>0)){var x=M[O],C=Math.floor(u*c.spotlightScaleFactor/(O+1)),k=(360-x.hue-90+s)%360*Math.PI/180,B=x.light*u/100,j=B*Math.cos(k),E=B*Math.sin(k);t.lineWidth=c.lineWidth,t.beginPath(),t.arc(j+l,E+h,C,0,2*Math.PI),t.strokeStyle=$({hue:(x.hue+180)%360,saturation:100,light:100-x.light}),t.fillStyle=$(x),t.stroke(),t.fill()}}}},{key:"makeConcentricPixelator",value:function(t,e){var n=e.width,o=e.height,i=n*o*4,r=new Uint8ClampedArray(n*o*4),a=new ImageData(r,n);return function(e,n,o,c,s){performance.now();var u=i/e.length-1;u-=u%4,u=Math.min(u,i);for(var l=u,h=0,f=(l+h)/2,d=(l-h)/2,v=0;v<l;v+=4)for(var p=Math.abs(v-f)/d*o,g=Math.random()-c,m=0;m<e.length;m++){var b=g<p?n[Math.floor(Math.random()*n.length)]:e[e.length-m-1][Math.floor(Math.random()*e[m].length)];r[m*u+v]=b.red,r[m*u+v+1]=b.green,r[m*u+v+2]=b.blue,r[m*u+v+3]=255}performance.now();t.putImageData(a,0,0)}}},{key:"mounted",value:function(){var t=this,e=document.getElementById("canvas"),n=e.getContext("2d");this.ctx=n,this.resize();var o=0,i=function(){o>t.options.display.waitBeforeClearMilliseconds?(n.clearRect(0,0,t.options.canvas.width,t.options.canvas.height),o=0):o+=t.options.display.tickMilliseconds},r=function(){var e=t.midiBatcher.getNotes(),o=H(t.options.circle,e);if(0==o.length)i();else{var r=X(t.options.mix,o,e.map((function(t){return t.velocity})));n.clearRect(0,0,t.options.canvas.width,t.options.canvas.height),n.rect(0,0,t.options.canvas.width,t.options.canvas.height),n.fillStyle=$(r),n.fill()}},c=function(){var e=t.midiBatcher.getNotes(),o=H(t.options.circle,e);if(0==o.length)i();else{var r=o.map((function(e){return Y(e,t.options.overtone).map((function(t){return t.color}))}));r.push(T(r,(function(n){return X(t.options.mix,n,e.map((function(t){return t.velocity})))})));var a=N(r,$);t.drawAll(n,a,t.options.canvas)}},s=function(){var e=t.midiBatcher.getNotes(),n=e.map((function(t){return t.velocity})),o=H(t.options.circle,e);if(0==o.length)i();else{var r=Object(a["a"])(o),c=r.map((function(e){return Y(e,t.options.overtone)})),s=r.length>0?Y(X(t.options.mix,r,n),t.options.overtone):[],u=[];c.forEach((function(t){var e=[];t.forEach((function(t){for(var n=U(t.color),o=0;o<Math.floor(100*t.weight);o++)e.push(n)})),u.push(e)}));var l=[];s.forEach((function(t){for(var e=U(t.color),n=0;n<Math.floor(100*t.weight);n++)l.push(e)})),t.concentricPixelator(u,l,t.options.render.emergentBias,t.options.render.emergentBiasFloor,t.options.mix.considerVelocity?n:void 0)}},u=function(){var e=t.midiBatcher.getNotes(),n=H(t.options.circle,e),o=Object(a["a"])(n),i=o.map((function(e){return Y(e,t.options.overtone)})),r=Y(X(t.options.mix,o,e.map((function(t){return t.velocity}))),t.options.overtone);i.push(r),t.wheelDrawer(N(i,(function(t){return t.color})),t.options.wheelViewModeConfig,t.options.circle.degreeOffset)},l=function(){t.midiBatcher.tick(),t.options.viewMode.single?r():t.options.viewMode.overtoneGrid?c():t.options.viewMode.wheel?u():t.options.viewMode.randomPixelation?t.randomPixelator(t.midiBatcher,ot(t.options),i):s()},h=function e(){l(),setTimeout(e,t.options.display.tickMilliseconds)};setTimeout(h,this.options.display.tickMilliseconds),et.a.enable((function(e){void 0!=e?console.log("Error trying to setup midi listener: "+e.name):console.log("Successfully set up midi listner."),console.log(et.a.inputs),console.log(et.a.outputs),0==et.a.inputs.length&&console.log("No midi input device detected.");var n=et.a.inputs[0];n.addListener("midimessage","all",(function(e){e.data[0]>>4==11&&64==e.data[1]&&(e.data[2]<=63?t.midiBatcher.endSustain():t.midiBatcher.beginSustain())})),n.addListener("noteon","all",(function(e){t.midiBatcher.handleNoteOn(e.note.number,e.note.octave,e.velocity)})),n.addListener("noteoff","all",(function(e){t.midiBatcher.handleNoteOff(e.note.number)}))}),!0)}}]),n}(f["c"]);at=Object(h["a"])([Object(f["a"])({components:{OptionsEditor:S,VApp:_["a"],VMain:V["a"],VTabs:D["a"],VTab:F["a"],VTabItem:I["a"],VContainer:g["a"],VRow:m["a"],VCol:b["a"],VBtn:O["a"]}})],at);var ct=at,st=ct,ut=(n("5c0b"),Object(E["a"])(st,i,r,!1,null,null,null)),lt=ut.exports,ht=n("f309"),ft=(n("bf40"),new ht["a"]({}));o["a"].use(ht["a"]),o["a"].config.productionTip=!1,new o["a"]({vuetify:ft,render:function(t){return t(lt)}}).$mount("#app")}});
//# sourceMappingURL=app.1b6dbdfc.js.map